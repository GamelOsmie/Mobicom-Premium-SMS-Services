import{i as j,k as B,l as _,s as g,n as $,u as D,j as e,L as I,N as P,m as R,c as z,f as K,g as Q,r as u,e as L}from"./index-Zq4SKFCc.js";const W=n=>{const o=j();return B({mutationFn:d=>_({method:"post",url:"/blast-sms",data:d}),...n,onSettled:d=>{const{status:l,message:i}=d;l==="success"&&o(g({type:"success",message:i})),l==="error"&&o(g({type:"error",message:i}))}})},H=n=>{const o=j();return $({queryKey:["sms-target-group",n],queryFn:()=>_({url:`/${n}/subscribers/sms-targets`}),onSettled:async d=>{const{status:l,message:i}=d;l==="error"&&o(g({type:"error",message:i}))}})},J=({options:n,category:o})=>{const d=j();return B({mutationFn:l=>_({method:"post",url:`/${o}/subscribers/search`,data:l}),...n,onSettled:l=>{const{status:i,message:b}=l;i==="error"&&d(g({type:"error",message:b}))}})};function O(){var w,M,k;const{category:n,message:o}=K(),d=Q(),[l,i]=u.useState(""),[b,f]=u.useState([]),[S,x]=u.useState(0),[t,N]=u.useState(""),[r,h]=u.useState([]),[A,p]=u.useState({all_subscribers:!1,all_enough_balance:!1,all_low_balance:!1,list:[]}),{data:a}=H(n),{mutate:C,isLoading:y}=J({category:n,options:{onSuccess:s=>{const{status:c,data:m}=s;c=="success"&&f(m)}}}),{mutate:E,isLoading:v}=W({onSuccess:s=>{const{status:c}=s;c=="success"&&d(-1)}}),F=()=>{const s={message:o,category:n,group:A};console.log(s),E(s)};u.useEffect(()=>{l.startsWith("232")&&l.length<=6||l.length>=3&&C({term:l})},[l]),u.useEffect(()=>{var s,c,m;t==""&&x(0),t=="all"&&(x((s=a==null?void 0:a.data)==null?void 0:s.all_subscribers),i(""),f([])),t=="enough-balance"&&(x((c=a==null?void 0:a.data)==null?void 0:c.all_enough_balance),i(""),f([])),t=="low-balance"&&(x((m=a==null?void 0:a.data)==null?void 0:m.all_low_balance),i(""),f([])),r.length&&x(r.length)},[t,r]),u.useEffect(()=>{t==""&&(p({all_subscribers:!1,all_enough_balance:!1,all_low_balance:!1,list:[]}),h([])),t=="all"&&(p({all_subscribers:!0,all_enough_balance:!1,all_low_balance:!1,list:[]}),h([])),t=="enough-balance"&&(p({all_subscribers:!1,all_enough_balance:!0,all_low_balance:!1,list:[]}),h([])),t=="low-balance"&&(p({all_subscribers:!1,all_enough_balance:!1,all_low_balance:!0,list:[]}),h([])),r.length&&p({all_subscribers:!1,all_enough_balance:!1,all_low_balance:!1,list:r})},[t]);const G=async s=>{N("");let c=[];if(!r.includes(s))c=[...r,s],h([...r,s]);else{const m=r.filter(q=>q!=s);c=m,h(m)}p({all_subscribers:!1,all_enough_balance:!1,all_low_balance:!1,list:c}),x(r.length)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 items-center pb-8 mb-10 border-b",children:[e.jsx("h2",{className:"text-3xl font-medium mb-10 md:mb-0",children:"SMS Management"}),e.jsxs("div",{className:"col-span-2 md:col-span-1  flex flex-wrap items-center justify-end",children:[e.jsx("input",{type:"text",id:"base-input",value:l,onChange:s=>{i(s.target.value)},className:"input w-full md:w-1/2 lg:w-2/6 mb-3 md:mb-0",placeholder:"enter search term"}),S>0?e.jsxs("button",{disabled:v,onClick:F,type:"button",className:"btn-primary md:ml-4 w-full md:w-fit flex gap-2 items-center",children:[e.jsx(L,{className:"text-xl"})," ",v?"sending":"Blast SMS"]}):e.jsxs("button",{type:"button",className:"cursor-not-allowed btn-secondary text-gray-400 md:ml-4 w-full md:w-fit flex gap-2 items-center",children:[e.jsx(L,{className:"text-xl"})," Blast SMS"]})]})]}),e.jsx("div",{children:e.jsx("div",{className:"mb-5",children:e.jsxs("div",{className:"flex flex-col justify-between items-center md:flex-row gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"countries",className:"block mb-2 text-xs font-medium text-gray-900 dark:text-gray-400",children:"Recipients"}),e.jsxs("select",{id:"countries",className:"input p-2 text-xs w-full",value:t,onChange:s=>N(s.target.value),children:[e.jsx("option",{value:"",children:"Select recipient group "}),e.jsx("option",{value:"all",children:"All Subscribers"}),e.jsx("option",{value:"enough-balance",children:"All Enough Balance"}),e.jsx("option",{value:"low-balance",children:"All Low Balance"})]})]}),e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsx("p",{className:"text-5xl",children:S})," ",e.jsxs("p",{className:"text-sm leading-none",children:["recipients ",e.jsx("br",{})," selected"]})]})]})})}),e.jsxs("div",{className:"relative overflow-x-auto sm:rounded-lg mb-10",children:[e.jsxs("table",{className:"w-full text-sm text-left text-gray-500 dark:text-gray-400",children:[e.jsx("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3",children:"id"}),e.jsxs("th",{scope:"col",className:"px-6 py-3",children:["MSISDN"," "]}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Balance Status"})]})}),e.jsx("tbody",{children:b==null?void 0:b.map((s,c)=>e.jsxs("tr",{onClick:()=>G(s),className:`${r.includes(s)?"bg-primary_transparent":"bg-white"} border-b cursor-pointer hover:scale-[.98] duration-500`,children:[e.jsx("td",{className:"px-6 py-4",children:c+1}),e.jsx("th",{scope:"row",className:"px-6 py-4 capitalize font-medium text-gray-900 whitespace-nowrap dark:text-white",children:s==null?void 0:s.msisdn_no}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:s!=null&&s.has_enough_balance?"active-pill":"inactive-pill",children:s!=null&&s.has_enough_balance?"Enough Balance":"Low Balance"})})]},s._id))})]}),y&&e.jsx("div",{className:"p-10 text-center text-sm",children:"getting subscribers..."}),l!=null&&l.length&&!(b!=null&&b.length)&&!y?e.jsx("div",{className:"p-10 text-center text-sm",children:"No subscriber found"}):null,!(l!=null&&l.length)&&t==""?e.jsx("div",{className:"p-10 text-center",children:"No subscribers selected to receive messages"}):null,!(l!=null&&l.length)&&t=="all"?e.jsxs("div",{className:"p-10 text-center",children:[e.jsx("span",{className:"font-semibold",children:(w=a==null?void 0:a.data)==null?void 0:w.all_subscribers})," ","subscribers selected to receive messages"]}):null,!(l!=null&&l.length)&&t=="enough-balance"?e.jsxs("div",{className:"p-10 text-center",children:[e.jsx("span",{className:"font-semibold",children:(M=a==null?void 0:a.data)==null?void 0:M.all_enough_balance})," ","subscribers selected to receive messages"]}):null,!(l!=null&&l.length)&&t=="low-balance"?e.jsxs("div",{className:"p-10 text-center",children:[e.jsxs("span",{className:"font-semibold",children:[" ",(k=a==null?void 0:a.data)==null?void 0:k.all_low_balance]})," ","subscribers selected to receive messages"]}):null]})]})}function V(){const{user:n}=D(o=>o.user);return e.jsx("div",{className:"bg-black",children:e.jsx(I,{headerArea:e.jsx(P,{menuLinks:n.user_role.includes("Admin")?R:z}),mainArea:e.jsx(O,{})})})}export{V as default};
